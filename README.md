# Movie Recommendation System using Text Embeddings (MovieLens 100k)

## Overview

This project implements a movie recommendation system using the MovieLens 100k dataset. It uses text embeddings generated by the OpenAI API to recommend movies based on user input (demographics and preferences). The core idea is to represent both users and movies as dense vectors (embeddings) in a semantic space and recommend movies whose embeddings are closest to the user's profile embedding.

The project also includes previous iterations comparing a naive user-based collaborative filtering approach (using rating similarity) with an embedding-based approach for *existing* users in the dataset, providing context for the advantages of using semantic embeddings.

## Features

*   **Data Processing:** Scripts to process the raw MovieLens 100k data into structured text profiles for users and movies.
*   **Embedding Generation:** Uses the OpenAI API to generate semantic vector embeddings for movie text profiles.
*   **User Input Recommendations:** Recommends movies based on new user input (age, gender, occupation, liked genres/movies, disliked movies) by generating a user profile embedding on-the-fly and finding movies with the highest cosine similarity.

## Dataset

*   **MovieLens 100k:** Contains 100,000 ratings (1-5) from 943 users on 1,682 movies. Includes user demographics and movie metadata (genres, titles).
*   Source: [https://grouplens.org/datasets/movielens/100k/](https://grouplens.org/datasets/movielens/100k/)

## Methodology

1.  **Text Profile Generation (`get_text_profiles.py`):**
    *   Reads raw MovieLens data (`u.data`, `u.user`, `u.item`, `u.genre`).
    *   Constructs a descriptive text string for each movie (title, release date, genres).
    *   Constructs a descriptive text string for each *existing* user (demographics, sample rating history).
    *   Saves these profiles to CSV files (`data/processed/`).

2.  **Embedding Generation (`get_profile_embeddings_openai.py`):**
    *   Reads the movie text profiles generated in the previous step.
    *   Uses the configured OpenAI embedding model (e.g., `text-embedding-3-small`) via the OpenAI API to convert each movie's text profile into a numerical vector (embedding).
    *   Handles potential API rate limits using retries.
    *   Saves the movie IDs and their corresponding embeddings to a JSON file (`data/processed/movie_embeddings_openai.json`). *Note: User embeddings are also generated by this script but are not used by the primary user-input recommendation flow.*

3.  **Recommendation for User Input (`ML_model.py`):**
    *   Loads the pre-computed movie embeddings and movie titles.
    *   Takes user input (age, gender, occupation, likes, dislikes).
    *   Constructs a descriptive text profile *for this specific input*.
    *   Sends this profile text to the OpenAI API to get a user embedding *on-the-fly*.
    *   Calculates the cosine similarity between this user embedding and all pre-computed movie embeddings.
    *   Identifies the movies with the highest similarity scores.
    *   Filters out movies explicitly disliked by the user and movies with "unknown" titles in the dataset.
    *   Returns the top-K recommended movie titles, their IDs, and similarity scores.

## Technology Stack

*   **Language:** Python 3.x
*   **Core Libraries:**
    *   `pandas`: Data manipulation and loading.
    *   `numpy`: Numerical operations, vector handling.
    *   `scikit-learn`: Cosine similarity calculation.
*   **API Interaction:**
    *   `openai`: Official Python client for OpenAI API.
    *   `tenacity`: Retry logic for API calls.
*   **Utilities:**
    *   `tqdm`: Progress bars for long processes.
*   **External Service:** OpenAI API (requires an API key and account).

## Setup

1.  **Clone the Repository:**
    ```
    git clone 
    cd https://github.com/howl-anderson/Duke_25Sprint_AIPI540_Module3_Recommendation-Systems.git
    ```

2.  **Install Dependencies:**
    Create a `requirements.txt` file with the following content:
    ```
    openai
    pandas
    numpy
    scikit-learn
    tqdm
    tenacity
    requests # If using the download script from previous examples
    ```
    Then install:
    ```
    pip install -r requirements.txt
    ```

3.  **Set OpenAI API Key:**
    You **MUST** set your OpenAI API key as an environment variable named `OPENAI_API_KEY`. **Do not hardcode your key in the script.**
    *   **Linux/macOS:**
        ```
        export OPENAI_API_KEY='your_actual_openai_api_key'
        ```
    *   **Windows (Command Prompt):**
        ```
        set OPENAI_API_KEY=your_actual_openai_api_key
        ```
    *   **Windows (PowerShell):**
        ```
        $env:OPENAI_API_KEY='your_actual_openai_api_key'
        ```

5.  **Dataset:**
    *   The scripts are generally set up to download the MovieLens 100k dataset automatically if helper functions are included.
    *   Alternatively, manually download `ml-100k.zip` from the link above, extract it, and ensure the contents (like `u.data`, `u.item`, etc.) are located in `data/raw/ml-100k/` relative to your project root.

## Usage

1.  **Generate Text Profiles:**
    *   This script processes the raw MovieLens data into text descriptions.
    *   ```
        python path/to/get_text_profiles.py
        ```
    *   *Outputs:* `user_texts_for_llm.csv` and `movie_texts_for_llm.csv` in `data/processed/`.

2.  **Generate Movie Embeddings using OpenAI:**
    *   This script reads `movie_texts_for_llm.csv`, calls the OpenAI API for each movie profile, and saves the embeddings.
    *   *Note:* This can take time and incur costs depending on the number of items and the chosen OpenAI model.
    *   ```
        python path/to/get_profile_embeddings_openai.py
        ```
    *   *Outputs:* `movie_embeddings_openai.json` (and potentially `user_embeddings_openai.json`) in `data/processed/`. Make sure your main recommendation script is configured to load `movie_embeddings_openai.json`.

3.  **Get Recommendations for User Input:**
    *   This script loads the movie embeddings, takes user profile details, generates a user embedding on-the-fly via OpenAI, and finds the most similar movies.
    *   Modify the `user_input` dictionary within the script's `if __name__ == "__main__":` block to change the profile.
    *   ```
        python path/to/your_main_recommendation_script.py # e.g., user_input_recommender.py
        ```
    *   *Outputs:* Prints the generated user profile text and the top recommended movie titles, IDs, and similarity scores to the console.

## Example Output (User Input Recommendation)
